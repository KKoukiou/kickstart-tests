#test name: rpm-ostree-container-rhel9
# https://github.com/rhinstaller/anaconda/pull/5399
#
# Test that ostreecontainer ks command works on rhel9.
# Tests only installation of the palyload.
# Does not test that the installation is bootable, bootloader is disabled,
# its installation should be fixed in a follow-up bootupd work.


%ksappend common/common.ks
%ksappend users/default.ks
%ksappend network/default.ks
%ksappend l10n/default.ks
%ksappend storage/default.ks

# Disable the boot loader.
bootloader --disabled

# Set up the RPM OSTree source.
ostreecontainer --no-signature-verification --transport=registry --url=quay.io/centos-bootc/centos-bootc:stream9

%post

# Check the url of the remote.
url="$(ostree remote show-url default)"
if [ "${url}" != "quay.io/centos-bootc/centos-bootc:stream9" ]; then
    echo "Unexpected URL: ${url}" >> /root/RESULT
fi

if [ ! -e /root/RESULT ]; then
    echo SUCCESS > /root/RESULT
fi

# Write the result into logs.
cat /root/RESULT
%end
